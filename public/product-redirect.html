<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>პროდუქტის გვერდი</title>
  <link rel="stylesheet" href="/shop/styles.css">
  <script>
    // პროდუქტის ID ამოღება URL-დან
    function getProductIdFromUrl() {
      const path = window.location.pathname;
      console.log('Product path:', path);
      
      // პირდაპირი პატერნის შედარება
      const match = path.match(/\/shop\/product\/([^\/]+)/);
      if (match && match[1]) {
        return match[1];
      }
      
      // ალტერნატიული პატერნი GitHub Pages-ისთვის
      const altMatch = path.match(/\/shop\/shop\/product\/([^\/]+)/);
      if (altMatch && altMatch[1]) {
        return altMatch[1];
      }
      
      return null;
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      const productId = getProductIdFromUrl();
      if (productId) {
        localStorage.setItem('currentProductId', productId);
        document.getElementById('productId').textContent = productId;
        console.log('პროდუქტის ID შენახულია:', productId);
        
        // დავიწყოთ კლიენტის კომპონენტის ჩატვირთვა
        loadProductComponent(productId);
      } else {
        document.getElementById('error').style.display = 'block';
      }
    });
    
    // კლიენტის კომპონენტის ჩატვირთვა
    function loadProductComponent(id) {
      try {
        // დავიმპორტოთ Firebase სერვისი
        import('/shop/firebase-service.js')
          .then(module => {
            // გამოვიძახოთ პროდუქტის მონაცემების ჩატვირთვა
            return module.getProductById(id);
          })
          .then(product => {
            if (product) {
              displayProduct(product);
            } else {
              document.getElementById('error').style.display = 'block';
            }
          })
          .catch(error => {
            console.error('Error loading product:', error);
            document.getElementById('error').style.display = 'block';
          });
      } catch (e) {
        console.error('Error during import:', e);
        // თუ დინამიური იმპორტი ვერ მუშაობს, გადავამისამართოთ მთავარ გვერდზე
        setTimeout(() => {
          window.location.href = '/shop/';
        }, 2000);
      }
    }
    
    // პროდუქტის ჩვენება გვერდზე
    function displayProduct(product) {
      document.getElementById('productName').textContent = product.name;
      document.getElementById('productPrice').textContent = `₾${product.price.toFixed(2)}`;
      document.getElementById('productDescription').textContent = product.description;
      
      // სურათების ჩვენება
      if (product.images && product.images.length > 0) {
        const image = document.createElement('img');
        image.src = product.images[0];
        image.alt = product.name;
        image.style.maxWidth = '100%';
        document.getElementById('productImage').appendChild(image);
      }
      
      // დავმალოთ ჩატვირთვის ანიმაცია
      document.getElementById('loading').style.display = 'none';
      // გამოვაჩინოთ პროდუქტის კონტეინერი
      document.getElementById('productContainer').style.display = 'block';
    }
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    .product-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }
    @media (max-width: 768px) {
      .product-grid {
        grid-template-columns: 1fr;
      }
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .error {
      color: red;
      text-align: center;
      display: none;
    }
    .product-name {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .product-price {
      font-size: 20px;
      font-weight: bold;
      color: #e44d26;
      margin-bottom: 20px;
    }
    .product-description {
      margin-bottom: 20px;
      line-height: 1.6;
    }
    .back-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 20px 0;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading">
      <h2 style="text-align: center;">პროდუქტი იტვირთება...</h2>
      <p style="text-align: center;">ID: <span id="productId"></span></p>
      <div class="spinner"></div>
    </div>
    
    <div id="error" class="error">
      <h2>პროდუქტი ვერ მოიძებნა</h2>
      <p>გთხოვთ, დაბრუნდეთ <a href="/shop/">მთავარ გვერდზე</a></p>
    </div>
    
    <div id="productContainer" style="display: none;">
      <div class="product-grid">
        <div id="productImage"></div>
        <div>
          <h1 id="productName" class="product-name"></h1>
          <div id="productPrice" class="product-price"></div>
          <div id="productDescription" class="product-description"></div>
          <button onclick="window.location.href='/shop/'" class="back-button">დაბრუნება მთავარ გვერდზე</button>
        </div>
      </div>
    </div>
  </div>
</body>
</html> 